<?xml version="1.0"?>
<?xml-stylesheet href="chrome://global/skin/" type="text/css"?>
<?xml-stylesheet href="chrome://zotero/skin/preferences.css"?>

<!DOCTYPE window SYSTEM "chrome://zotero/locale/zotero.dtd">

<window
    xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
    xmlns:html="http://www.w3.org/1999/xhtml"
    title="ZotMoov"
    drawintitlebar-platforms="mac"
    class="zotero-dialog"
    style="min-width: 300px;"
    onload="myOnLoad();">
<dialog buttons="cancel,accept" id="zotmoov-cw-dialog">
    <script src="chrome://zotero/content/include.js"/>

    <linkset><html:link rel="localization" href="zotmoov.ftl"/></linkset>

    <vbox style='margin-bottom: 10px;'>
        <hbox align="center">
            <label data-l10n-id="zotmoov-adv-settings-wc-command"/>
            <menulist native="true" id="zotmoov-adv-settings-wc-sel-menu">
                <menupopup>
                    <menuitem value="text" label="text" oncommand="loadState(TextState);"/>
                    <menuitem value="toLowerCase" label="toLowerCase"/>
                    <menuitem value="toUpperCase" label="toUpperCase"/>
                    <menuitem value="trim" label="trim"/>
                    <menuitem value="exec" label="exec"/>
                    <menuitem value="replace" label="replace"/>
                </menupopup>
            </menulist>
        </hbox>
        <vbox>
            <hbox><label id="zotmoov-cw-label1"></label></hbox>
            <hbox><html:input id="zotmoov-cw-text-input1" type="text" style="flex: 1; display: none;"/></hbox>
        </vbox>
        <vbox>
            <hbox><label id="zotmoov-cw-label2"></label></hbox>
            <hbox><html:input id="zotmoov-cw-text-input2" type="text" style="flex: 1; display: none;"/></hbox>
            <hbox><html:input id="zotmoov-cw-number-input2" type="number" style="flex: 1; display: none;" min="1"/></hbox>
        </vbox>
        <vbox>
            <hbox><label id="zotmoov-cw-label3"></label></hbox>
            <hbox><html:input id="zotmoov-cw-text-input3" type="text" style="flex: 1; display: none;"/></hbox>
        </vbox>
    </vbox>

    <script>
    <![CDATA[
        document.addEventListener('dialogaccept', () => myOnAccept());
        let wc;

        class TextState
        {
            static load()
            {
                document.getElementById('zotmoov-cw-label1').setAttribute('data-l10n-id', 'zotmoov-adv-settings-text-label1')

                let txt_input = document.getElementById('zotmoov-cw-text-input1');
                txt_input.style.display = '';
                txt_input.setAttribute('oninput', 'TextState.onInput();');
            }

            static unload()
            {
                document.getElementById('zotmoov-cw-label1').setAttribute('data-l10n-id', '')

                let txt_input = document.getElementById('zotmoov-cw-text-input1');
                txt_input.style.display = 'none';
                txt_input.setAttribute('oninput', '');
            }

            static onAccept()
            {
                const text = document.getElementById('zotmoov-cw-text-input1').value;
                Zotero.ZotMoov.Prefs.Advanced.createCWEntry(wc, 'text', text);
            }

            static onInput()
            {
                document.getElementById('zotmoov-cw-dialog').getButton('accept').disabled = event.target.value.trim() === '';
            }
        }

        {
            let current_state;
            function loadState(state)
            {
                if (current_state) current_state.unload();
                state.load();
                current_state = state;
            }

            function myOnAccept()
            {
                current_state.onAccept();
            }
        }

        function myOnLoad()
        {
            if (window.arguments) wc = window.arguments[0];
            document.getElementById('zotmoov-cw-dialog').getButton('accept').disabled = true;
            loadState(TextState);
        }

    ]]>
    </script>
</dialog>
</window>